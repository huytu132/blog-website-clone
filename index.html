<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Tr·∫Øc nghi·ªám C√°n b·ªô</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    .hidden { display: none; }
    .btn { padding: 8px 12px; margin: 4px; border: none; cursor: pointer; border-radius: 6px; }
    .btn-blue { background: #3b82f6; color: white; }
    .btn-green { background: #16a34a; color: white; }
    .btn-red { background: #dc2626; color: white; }
    .option { margin: 6px 0; padding: 6px; border-radius: 6px; cursor: pointer; border: 1px solid #ccc; }
    .correct { background: #bbf7d0; }
    .wrong { background: #fecaca; }
  </style>
</head>
<body>
  <div id="header">
    <button class="btn btn-blue" onclick="showMenu()">üè† Trang ch·ªß</button>
  </div>

  <h1>Tr·∫Øc nghi·ªám C√°n b·ªô</h1>
  <div id="menu"></div>
  <div id="quiz" class="hidden"></div>

  <script>
    let quizData = null;
    let currentSection = null;
    let currentIndex = 0;

    const menuDiv = document.getElementById("menu");
    const quizDiv = document.getElementById("quiz");

    // ====== Load JSON ======
    fetch("questions.json")
      .then(res => res.json())
      .then(data => {
        quizData = data;
        showMenu();
      })
      .catch(err => {
        menuDiv.innerHTML = "<p style='color:red'>L·ªói t·∫£i file questions.json</p>";
        console.error(err);
      });

    // ====== H√†m x√°o tr·ªôn ======
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // ====== Hi·ªán menu ======
    function showMenu() {
      quizDiv.classList.add("hidden");
      menuDiv.innerHTML = `
        <h2>${quizData.title}</h2>
        <p>${quizData.description}</p>
        <h3>Ch·ªçn m·ª•c ƒë·ªÉ l√†m b√†i</h3>
        ${quizData.sections.map(sec => 
          `<button class="btn btn-blue" onclick="startSection('${sec.id}')">${sec.title}</button>`
        ).join("")}
        <button class="btn btn-green" onclick="startAll()">L√†m t·∫•t c·∫£</button>
      `;
    }

    // ====== Start Section ======
    function startSection(id) {
      const section = quizData.sections.find(s => s.id === id);
      currentSection = {
        id: section.id,
        title: section.title,
        questions: shuffle([...section.questions]) // x√°o tr·ªôn
      };
      currentIndex = 0;
      showQuestion();
    }

    // ====== Start All ======
    function startAll() {
      currentSection = {
        id: "all",
        title: "T·∫•t c·∫£ c√¢u h·ªèi",
        questions: shuffle(quizData.sections.flatMap(s => s.questions)) // x√°o tr·ªôn
      };
      currentIndex = 0;
      showQuestion();
    }

    // ====== Show Question ======
    function showQuestion() {
      menuDiv.innerHTML = "";
      quizDiv.classList.remove("hidden");

      const q = currentSection.questions[currentIndex];
      quizDiv.innerHTML = `
        <h3>${currentSection.title}</h3>
        <p><b>C√¢u ${currentIndex + 1}:</b> ${q.question}</p>
        <div id="options">
          ${q.options.map((opt, i) =>
            `<div class="option" onclick="checkAnswer(${i})">${opt}</div>`
          ).join("")}
        </div>
        <div id="nav"></div>
      `;
    }

    // ====== Check Answer ======
    function checkAnswer(choice) {
      const q = currentSection.questions[currentIndex];
      const optionsDiv = document.getElementById("options");
      const optionEls = optionsDiv.querySelectorAll(".option");

      optionEls.forEach((el, i) => {
        if (i === q.correct) el.classList.add("correct");
        if (i === choice && choice !== q.correct) el.classList.add("wrong");
        el.style.pointerEvents = "none";
      });

      document.getElementById("nav").innerHTML = `
        <button class="btn btn-blue" onclick="retry()">L√†m l·∫°i</button>
        ${currentIndex > 0 ? `<button class="btn btn-blue" onclick="prev()">Quay l·∫°i</button>` : ""}
        ${currentIndex < currentSection.questions.length - 1 
          ? `<button class="btn btn-green" onclick="next()">Next</button>`
          : `<button class="btn btn-red" onclick="showMenu()">K·∫øt th√∫c</button>`}
      `;
    }

    // ====== Retry / Next / Prev ======
    function retry() { showQuestion(); }
    function next() { currentIndex++; showQuestion(); }
    function prev() { currentIndex--; showQuestion(); }
  </script>
</body>
</html>
