<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <title>Tr·∫Øc nghi·ªám C√°n b·ªô</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      line-height: 1.5;
    }

    .hidden {
      display: none;
    }

    .btn {
      padding: 10px 14px;
      margin: 6px 4px;
      border: none;
      cursor: pointer;
      border-radius: 6px;
      font-size: 16px;
      transition: background 0.2s ease;
    }

    .btn:hover {
      opacity: 0.9;
    }

    .btn-blue {
      background: #3b82f6;
      color: white;
    }

    .btn-green {
      background: #16a34a;
      color: white;
    }

    .btn-red {
      background: #dc2626;
      color: white;
    }

    .option {
      margin: 8px 0;
      padding: 10px;
      border-radius: 6px;
      cursor: pointer;
      border: 1px solid #ccc;
      transition: background 0.2s ease;
      font-size: 16px;
    }

    .option:hover {
      background: #f3f4f6;
    }

    .correct {
      background: #bbf7d0 !important;
    }

    .wrong {
      background: #fecaca !important;
    }

    a {
      text-decoration: none;
      color: white;
    }

    #header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    #menu,
    #quiz {
      max-width: 900px;
      margin: auto;
    }

    /* ===== Responsive ===== */
    @media (max-width: 768px) {
      body {
        margin: 10px;
        font-size: 15px;
      }

      .btn {
        font-size: 14px;
        padding: 8px 12px;
      }

      .option {
        font-size: 14px;
        padding: 8px;
      }
    }

    @media (max-width: 480px) {
      h1 {
        font-size: 20px;
      }

      h2,
      h3 {
        font-size: 18px;
      }

      .btn {
        display: block;
        width: 100%;
        margin: 6px 0;
        font-size: 14px;
      }

      .option {
        font-size: 14px;
        padding: 8px;
      }
    }
  </style>
</head>

<body>
  <div id="header">
    <button class="btn btn-blue" onclick="showMenu()">üè† Trang ch·ªß</button>
  </div>

  <h1>Tr·∫Øc nghi·ªám C√°n b·ªô</h1>
  <div id="menu"></div>
  <div id="quiz" class="hidden"></div>

  <script>
    let quizData = null;
    let currentSection = null;
    let currentIndex = 0;
    let shuffledOptions = []; // l∆∞u ƒë√°p √°n sau khi x√°o

    const menuDiv = document.getElementById("menu");
    const quizDiv = document.getElementById("quiz");

    // ====== Load JSON ======
    fetch("questions.json")
      .then(res => res.json())
      .then(data => {
        quizData = data;
        showMenu();
      })
      .catch(err => {
        menuDiv.innerHTML = "<p style='color:red'>L·ªói t·∫£i file questions.json</p>";
        console.error(err);
      });

    // ====== H√†m x√°o tr·ªôn ======
    function shuffle(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }

    // ====== Hi·ªán menu ======
    function showMenu() {
      quizDiv.classList.add("hidden");
      menuDiv.innerHTML = `
        <h2>${quizData.title}</h2>
        <p>${quizData.description}</p>
        <h3>Ch·ªçn m·ª•c ƒë·ªÉ l√†m b√†i</h3>
        ${quizData.sections.map(sec =>
        `<button class="btn btn-blue" onclick="startSection('${sec.id}')">${sec.title}</button>`
      ).join("")}
        <button class="btn btn-green" onclick="startAll()">L√†m t·∫•t c·∫£</button>
        <h3>Ki·ªÉm tra</h3>
        <button class="btn btn-green""><a href="exam.html">Ch·ªçn ng·∫´u nhi√™n 40 c√¢u</a></button>
      `;
    }

    // ====== Start Section ======
    function startSection(id) {
      const section = quizData.sections.find(s => s.id === id);
      currentSection = {
        id: section.id,
        title: section.title,
        questions: shuffle([...section.questions]) // x√°o tr·ªôn c√¢u h·ªèi
      };
      currentIndex = 0;
      showQuestion();
    }

    // ====== Start All ======
    function startAll() {
      currentSection = {
        id: "all",
        title: "T·∫•t c·∫£ c√¢u h·ªèi",
        questions: shuffle(quizData.sections.flatMap(s => s.questions)) // x√°o tr·ªôn c√¢u h·ªèi
      };
      currentIndex = 0;
      showQuestion();
    }

    // function startFortyQuestions(){
    //     const data = shuffle(quizData.sections.flatMap(s => s.questions)).slice(0,40);
    //     currentSection = {
    //         id: "40",
    //         title: "40 c√¢u ng·∫´u nhi√™n",
    //         questions:  data// x√°o tr·ªôn c√¢u h·ªèi
    //     };
    //     currentIndex = 0;
    //     showExam();
    // }

    // ====== Show Question ======
    function showQuestion() {
      menuDiv.innerHTML = "";
      quizDiv.classList.remove("hidden");

      const q = currentSection.questions[currentIndex];

      // T·∫°o m·∫£ng options c√≥ ƒë√°nh d·∫•u ƒë√∫ng/sai
      shuffledOptions = q.options.map((opt, i) => ({
        text: opt,
        isCorrect: i === q.correct
      }));

      // X√°o tr·ªôn ƒë√°p √°n
      shuffle(shuffledOptions);

      quizDiv.innerHTML = `
        <h3>${currentSection.title}</h3>
        <p><b>C√¢u ${currentIndex + 1}:</b> ${q.question}</p>
        <div id="options">
          ${shuffledOptions.map((opt, i) =>
        `<div class="option" onclick="checkAnswer(${i})">${opt.text}</div>`
      ).join("")}
        </div>
        <div id="nav"></div>
      `;
    }

    // ====== Check Answer ======
    function checkAnswer(choice) {
      const optionsDiv = document.getElementById("options");
      const optionEls = optionsDiv.querySelectorAll(".option");

      optionEls.forEach((el, i) => {
        if (shuffledOptions[i].isCorrect) el.classList.add("correct");
        if (i === choice && !shuffledOptions[i].isCorrect) el.classList.add("wrong");
        el.style.pointerEvents = "none";
      });

      document.getElementById("nav").innerHTML = `
        <button class="btn btn-blue" onclick="retry()">L√†m l·∫°i</button>
        ${currentIndex > 0 ? `<button class="btn btn-blue" onclick="prev()">Quay l·∫°i</button>` : ""}
        ${currentIndex < currentSection.questions.length - 1
          ? `<button class="btn btn-green" onclick="next()">Next</button>`
          : `<button class="btn btn-red" onclick="showMenu()">K·∫øt th√∫c</button>`}
      `;
    }

    // ====== Retry / Next / Prev ======
    function retry() { showQuestion(); }
    function next() { currentIndex++; showQuestion(); }
    function prev() { currentIndex--; showQuestion(); }
  </script>
</body>

</html>